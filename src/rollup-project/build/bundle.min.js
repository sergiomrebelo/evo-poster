var version=function(){"use strict";const e=(e=[],t=null,l=[],o=null)=>{const i=document.createElement("div");if(null!==t){const e=n("h3",t,["d-inline"]);i.appendChild(e)}const d=document.createElement("p");for(let e of l)d.classList.add(e);return null!==o&&(d.id=o),i.appendChild(d),i},n=(e="h3",n,t=[],l=null)=>{const o=document.createElement(e);for(let e of t)o.classList.add(e);return null!==l&&(o.id=l),o.textContent=n,o},t=(e="div",n=[],t=null)=>{const l=document.createElement(e);for(let e of n)l.classList.add(e);return null!==t&&(l.id=t),l},l=(e="text",n=null,t=[],l=null,o=null,i=null)=>{const d=document.createElement("input");d.type=e,null!==n&&(d.value=n);for(let e of t)d.classList.add(e);return null!==l&&(d.id=l),null!==o&&(d.checked=o),null!==i&&(d.name=i),d},o=(e,n=[],t=null,l=null)=>{const o=document.createElement("button");null!==t&&(o.type=t),null!==l&&(o.id=l);for(let e of n)o.classList.add(e);return o.textContent=e,o},i=["ar","bn","bs","bg","zh","hr","cs","da","nl","en","et","fi","fr","de","el","gu","he","hi","hu","ga","id","it","ja","ko","lv","lt","ms","ml","mt","ne","nb","pl","pt","ro","ru","si","sk","sl","es","sv","ta","te","th","tr","uk","ur","vi","cy"],d=(e,n,t=[])=>{const l=document.createElement("label");l.setAttribute("for",e),l.textContent=n;for(let e of t)l.classList.add(e);return l},s=()=>t("div",["my-4"]),a=(e={success:!1})=>{document.querySelectorAll("#error-handle").forEach((e=>{e.remove()}));const n=t("div",["temp-results","container-fluid","bg-light"],"error-handle"),l=t("div",["row"]),o=t("section",["col-12","bg-warning","p-3"]),i=t("span",[],"err-message");return i.innerHTML=e.message,o.appendChild(i),l.appendChild(o),n.appendChild(l),document.body.appendChild(n),n};class c{constructor(){this.images={imageRandomPlacement:!0,hasImages:!1,blobs:[],amount:0,loading:!1,randomPlacement:!1},this.text=null,this.screen=0,this.IMAGE_SIZE=1024,this.init()}init=()=>{const a=(()=>{const l=t("div",["temp-results","container-fluid"],"temp-info"),o=t("div",["row"]),i=t("section",["col-10","offset-1","my-4"]),d=n("h1","Evolving Posters",["mb-3"]);i.appendChild(d);const s=t("div",["results-info","d-none"],"info-results-section"),a=e("","Input Text: ",["d-inline"],"temp-res-text");s.appendChild(a);const c=e("","Sentences: ",["d-inline"],"temp-res-sentences");s.appendChild(c);const m=e("","Classification results: ",["d-inline"],"temp-res-classification");s.appendChild(m);const r=t("div",["mt-4"]),p=n("h3","Lexicon results:",["d-block","my-0"]),h=t("div",[],"temp-res-lexicon-lines"),u=e("",null,[],"temp-res-lexicon-global");r.appendChild(p),r.appendChild(h),r.appendChild(u),s.appendChild(r),i.appendChild(s);const g=n("h3","Input Images",["d-none","text-uppercase"],"input-images-headline");i.appendChild(g);const f=t("div",["mt-4","d-none"],"input-images");return i.appendChild(f),l.appendChild(i),l.appendChild(o),l})(),c=(()=>{const e=t("aside",["container-fluid"]),n=t("div",["row"]),a=t("section",["input-form-outer","col-10","offset-1","mt-5"]),c=document.createElement("form");c.id="input-form",c.classList.add("input-form-inner");const m=document.createElement("fieldset"),r=t("div",["form-group","row","mb-2"]),p=document.createElement("textarea");p.id="formControlTextarea",p.classList.add("form-control","col-sm-10"),p.required=!0,p.rows=6;const h=d(p.id,"Input Text",["col-sm-2","col-form-label-sm"]);r.appendChild(h),r.appendChild(p),m.appendChild(r);const u=t("div",["form-group","row","mb-2"]),g=document.createElement("select");g.id="formControlLang",g.classList.add("form-control","form-control-lg");const f=d(g.id,"Language",["col-form-label-sm"]);for(let e of i){const n=document.createElement("option");n.textContent=e,n.value=e,n.selected="en"===e,g.appendChild(n)}u.appendChild(f),u.appendChild(g),m.appendChild(u),m.appendChild(s());const C=t("div",["form-check","form-check-inline","mb-2"],"lineDivisionField"),b=l("checkbox","1",["form-check-input"],"lineDivisionCheck",!0),I=d(b.id,"Automatic line division",["form-check-label","col-form-label-sm"]);b.addEventListener("change",(e=>{const n=document.getElementById("textDelimiterField");e.target.checked&&null!==n?n.classList.add("d-none"):n.classList.remove("d-none")}));const x=t("div",["form-group","row","mb-2","d-none"],"textDelimiterField"),y=l("text","Â¶",["form-control","form-control-lg"],"formControlTextDelimiter"),E=d(y.id,"Text Line delimiter",["col-form-label-sm"]);C.appendChild(I),C.appendChild(b),m.appendChild(C),x.appendChild(E),x.appendChild(y),m.appendChild(x),m.appendChild(s());const v=t("div",["form-group","row","mb-2"]),L=l("file",null,["form-control-file"],"formControlImages","files[]");L.accept="image/jpeg, image/png, image/jpg",L.multiple=!0;const k=d(L.id,"Images",["col-form-label-sm"]);v.appendChild(k),v.appendChild(L),m.appendChild(v);const $=t("div",["form-check","form-check-inline","mb-2","d-none"],"imagePlacementField"),w=l("checkbox","1",["form-check-input"],"imagePlacementCheck",!0),B=d(w.id,"Image Random Placement",["form-check-label","col-form-label-sm"]);$.appendChild(B),$.appendChild(w),m.appendChild($),w.addEventListener("change",(e=>{const n=document.getElementById("imageAnchorField");e.target.checked&&null!==n?n.classList.add("d-none"):n.classList.remove("d-none")}));const A=t("div",["form-group","row","mb-2","d-none"],"imageAnchorField"),P=l("text",null,["form-control","form-control-lg"],"formControlImagePlaceholderDelimiter",!1),R=d(P.id,"Image Placement Anchor",["col-form-label-sm"]);A.appendChild(R),A.appendChild(P),m.appendChild(A),m.appendChild(s());const T=t("div",["col-auto"]),D=o("Submit",["btn","btn-primary","mb-2"],"submit"),_=o("Reset",["btn","btn-secondary","mx-3","mb-2"],"reset");T.appendChild(D),T.appendChild(_),m.appendChild(T),c.appendChild(m),a.appendChild(c);const M=o("New Analysis",["btn","d-none","btn-secondary","my-2","nextBts"],null,"btReload");M.disabled=!0,M.onclick=()=>{window.location.reload()};const S=o("Next",["btn","d-none","btn-primary","my-2","nextBts","mx-3"],null,"btNext");return S.disabled=!0,a.appendChild(M),a.appendChild(S),e.appendChild(a),e.appendChild(n),e})();document.body.appendChild(a),document.body.appendChild(c),c.addEventListener("submit",this.get),document.getElementById("formControlImages").addEventListener("change",this._uploadImages)};get=async e=>{e.preventDefault();let n=encodeURIComponent(document.getElementById("formControlTextarea").value);const t=document.getElementById("lineDivisionCheck").checked,l=encodeURIComponent(document.getElementById("formControlLang").value);let o,i="text";if(t||(o=encodeURIComponent(document.getElementById("formControlTextDelimiter").value),i=`lines/${o}`),this.images.hasImages&&!this.images.randomPlacement&&!t){let e=encodeURIComponent(document.getElementById("formControlImagePlaceholderDelimiter").value);if(this.images.nAnchorPoints=[...n.matchAll(new RegExp(e,"g"))].length,n=n.replaceAll(e,`${o}${e}${o}`),this.images.nAnchorPoints!==app.images.amount){const e=app.images.nAnchorPoints>app.images.amount?"higher":"smaller";a({message:`the amount of image anchor points is ${e} than the amount of upload images. (anchors:${app.images.nAnchorPoints} / images:${app.images.amount})`})}}fetch(`/${i}/${l}/${n}`).then((e=>e.json())).then((e=>{this._displayResults(e)})).catch((e=>{console.error("Error:",e),a({message:`error on fetch. ${e}`})}))};_displayResults=async e=>{e.success||a(e.err),document.getElementById("temp-res-text").textContent=`${e.text} (${e.lang})`,document.getElementById("temp-res-sentences").textContent=`${e.sentences.flat()} (${e.sentences.flat().length})`,document.getElementById("temp-res-classification").textContent=`${e.classification.emotions.data.predominant.emotion} (${e.classification.emotions.data.predominant.weight})`;const n=document.getElementById("temp-res-lexicon-lines");n.innerHTML="";for(let t in e.lexicon.sentences){const l=e.lexicon.sentences[t],o=document.createElement("span");o.innerHTML=`[${t}] ${l.text} (${l.emotions.data.predominant.emotion}, ${l.emotions.data.predominant.weight}) <br>`,n.appendChild(o)}document.getElementById("temp-res-lexicon-global").innerHTML=`<b>global lexicon</b>: ${e.lexicon.global[0][0]} (${e.lexicon.global[0][1]})`,document.getElementById("temp-info").classList.replace("d-none","d-block"),document.querySelector("#input-form fieldset").disabled=!0,document.getElementById("btReload").enable=!0;document.getElementById("info-results-section").classList.replace("d-none","d-block");document.querySelectorAll(".nextBts").forEach((e=>{e.disabled=!1,e.classList.replace("d-none","d-inline")}))};_uploadImages=async e=>{this.images.blobs=[],this.images.hasImages=!0,this.images.loading=!0,this.images.amount=e.target.files.length,this.images.blobs=await this._readImages(e.target.files).catch((e=>{a(`not possible to load the image ${e}`)})),this.images.loading=!1,this._displayImages(this.images.blobs)};_displayImages=e=>{const n=document.getElementById("input-images");n.innerHTML="";for(let t=0;t<e.length;t++){const l=new Image;l.src=e[t],l.classList.add("d-inline-block","mb-2","mr-2"),l.style.height="100px",l.style.width="auto",n.appendChild(l)}n.classList.replace("d-none","d-block"),document.getElementById("input-images-headline").classList.replace("d-none","d-block")};_readImages=async e=>{const n=[];let t=[];const l=e=>{const n=new FileReader;return new Promise((t=>{n.onload=e=>{t(e.target.result)},n.readAsDataURL(e)}))};for(let o=0;o<e.length;o++)e[o].size/1024<this.IMAGE_SIZE?e[o].type.includes("image")?n.push(l(e[o])):t.push(`error loading the following image(s): ${e[o].name}.`):t.push(`${e[o].name} size bigger than ${this.IMAGE_SIZE}.`);if(t.length>0){let e="";for(let n=0;n<t.length;n++)e+=t[n],n!==t.length-1&&(e+="<br>");a({message:e})}return await Promise.all(n)}}return window.onload=()=>{new c},c}();
